<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>متجر سماوي</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    <style>body { font-family: 'Tajawal', sans-serif; }</style>
</head>
<body class="bg-slate-50 text-right">
    <header class="bg-white p-4 shadow-sm flex justify-between items-center">
        <h1 class="text-xl font-black text-indigo-700">سماوي ستور</h1>
        <button onclick="login()" id="login-btn" class="bg-indigo-600 text-white px-5 py-2 rounded-full text-sm font-bold">دخول</button>
        <button id="admin-btn" onclick="document.getElementById('admin').classList.toggle('hidden')" class="hidden bg-amber-500 text-white px-4 py-2 rounded-xl text-xs font-bold">لوحة الإدارة</button>
    </header>

    <div id="admin" class="hidden p-4 bg-indigo-900 text-white space-y-2">
        <input type="text" id="p-name" placeholder="اسم المنتج" class="w-full p-2 text-black rounded">
        <input type="number" id="p-price" placeholder="السعر" class="w-full p-2 text-black rounded">
        <input type="text" id="p-image" placeholder="رابط الصورة" class="w-full p-2 text-black rounded text-xs">
        <button onclick="save()" class="w-full bg-green-500 py-2 rounded font-bold">نشر المنتج</button>
    </div>

    <main class="p-6 grid grid-cols-2 gap-4" id="products"></main>

    <script>
        const config = {
            apiKey: "AIzaSyDTUtClavOl1VgKkDbZQ9rU7bOSFyrx7VI",
            authDomain: "smawystore.firebaseapp.com",
            databaseURL: "https://smawystore-default-rtdb.firebaseio.com",
            projectId: "smawystore",
            storageBucket: "smawystore.firebasestorage.app",
            messagingSenderId: "661134709839",
            appId: "1:661134709839:web:f0b227abc50d3ee1aa063a"
        };
        firebase.initializeApp(config);
        const db = firebase.database();
        const auth = firebase.auth();

        function login() {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithRedirect(provider);
        }

        auth.getRedirectResult().then(res => {
            if(res.user) {
                const p = prompt("رمز الإدارة (822000) أو اتركه فارغاً للزبائن:");
                if(p === "822000") localStorage.setItem("role", "admin");
                location.reload();
            }
        });

        auth.onAuthStateChanged(user => {
            if(user) {
                document.getElementById('login-btn').classList.add('hidden');
                if(localStorage.getItem("role") === "admin") document.getElementById('admin-btn').classList.remove('hidden');
            }
        });

        db.ref('products').on('value', snap => {
            const div = document.getElementById('products');
            div.innerHTML = "";
            snap.forEach(c => {
                const p = c.val();
                div.innerHTML += `
                <div class="bg-white p-3 rounded-2xl shadow-sm border">
                    <img src="${p.image}" class="w-full h-32 object-cover rounded-xl mb-2">
                    <h3 class="font-bold text-sm">${p.name}</h3>
                    <p class="text-indigo-600 font-bold text-xs">${Number(p.price).toLocaleString()} د.ع</p>
                    ${localStorage.getItem("role") === "admin" ? `<button onclick="db.ref('products/${c.key}').remove()" class="text-red-500 text-[10px] mt-2 border-t pt-1 w-full">حذف</button>` : ''}
                </div>`;
            });
        });

        function save() {
            const n = document.getElementById('p-name').value, pr = document.getElementById('p-price').value, img = document.getElementById('p-image').value;
            if(n && pr && img) db.ref('products').push({name:n, price:pr, image:img}).then(()=>alert("تم!"));
        }
    </script>
</body>
</html>
